<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    <title>WET Oligo</title>
</head>

<body>
    <div class="container text-center mt-5">
        <div class="row justify-content-start">
            <div class="col-12">
                <h2>CÔNG THỨC TÍNH TOÁN WET OLIGO</h2>
                <form>
                    <div class="input-group mt-5">
                        <input type="text" class="form-control" placeholder="Tên" id="oligoName">
                        <input type="text" class="form-control" placeholder="Trình tự 5' đến 3'" id="sequence">
                        <input type="text" class="form-control" placeholder="OD" id="OD">
                        <input type="text" class="form-control" placeholder="Volumne delivered " id="volumne">
                        <input type="text" class="form-control" placeholder="Conc.Wanted (pmol/µl)" id="concWanted">
                        <input type="text" class="form-control" placeholder="Conc.WS (pmol/µl)" id="concWS">
                        <input type="text" class="form-control" placeholder="Vol.(µl) of WS" id="volWS">
                        <button class="btn btn-primary" type="button" id="ketQuaWet">Thêm</button>
                        <button class="btn btn-primary" type="button" id="suaXong" style="display: none;">Sửa
                            xong</button>
                    </div>
                </form>
            </div>
            <div class="container text-start mt-3" id="huongDan"> </div>
            <div>
                <h2>WET OLIGO</h2>
            </div>
            <div id="displayWet"></div>
        </div>
    </div>
    </div>
    <script>
        var mangInp = [],
            mangTrinhTu = [],
            mangTotal = [],
            ten = document.getElementById('oligoName'),
            trinhTu = document.getElementById('sequence'),
            OD = document.getElementById('OD'),
            volumne = document.getElementById('volumne'),
            concWanted = document.getElementById('concWanted'),
            concWS = document.getElementById('concWS'),
            volWS = document.getElementById('volWS'),
            edit = A = G = C = T = 0,
            oligoConc, Mer, Mw, Tm, addedToODV, fromSS, ofbuffer;
        // chuỗi trình tự
        trinhTu.addEventListener('keyup', function () {
            trinhTu.value = trinhTu.value.toUpperCase().replace(/\s/g, "");
        })
        document.getElementById('ketQuaWet').addEventListener('click', function () {
            if (ten.value != '' && trinhTu.value != '' && OD.value != '' && volumne.value != '' && concWanted.value != '' && concWS.value != '' && volWS.value != '') {
                document.getElementById('huongDan').innerHTML = '';
                mangTrinhTu = trinhTu.value.split('');
                trinhTuA();
                themHang(ten.value, trinhTu.value, OD.value, volumne.value, concWanted.value, concWS.value, volWS.value);
                mangTotal.push(mangInp);
                hienThi();
                ten.value = trinhTu.value = OD.value = volumne.value = concWanted.value = concWS.value = volWS.value = '';
                // mangTrinhTu = [];
                console.log(mangTotal);
                console.log(mangTrinhTu);
                console.log(G, C, A, T);
            } else {
                document.getElementById('huongDan').innerHTML = `<p style="color: #ff0000" >Có thể 1 hoặc nhiều ô bạn đã bỏ trống </p>`
            }
        })
        function hienThi() {
            let text = '', count = 0, edit = 0;
            document.getElementById('displayWet').innerHTML = '';
            text = `<table class="table table-striped table-hover table-sm align-middle">
                           <tr>
                               <th> STT</th>
                               <th>Oligo Name</th>
                               <th>Sequence (5' to 3')</th>
                               <th>OD delivered</th>
                               <th>Volumne delivered </th>
                               <th>Oligo conc. delivered (pmol/µl)</th>
                               <th>Mer</th>
                               <th>Mw</th>
                               <th>Tm</th>
                               <th>Conc. Wanted (pmol/µl)</th>
                               <th>Vol.(µl) of buffer to be added to ODV</th>
                               <th>Conc.WS (pmol/µl)</th>
                               <th>Vol.(µl) of WS</th>
                               <th>Vol.(µl) from SS</th>
                               <th>Vol.(µl) of buffer</th>
                               <th colspan="2">Tuỳ chỉnh</th>
                           </tr>`;
            for (let i = 0; i < mangTotal.length; i++) {
                count++;
                text += `<tr><td>${count}</td>`
                for (let j = 0; j < mangTotal[i].length; j++) {
                    text += `<td>${mangTotal[i][j]}</td>`
                }
                text += `<td><button class="btn btn-link " onclick="sua(${i})" id="btn-sua">&#9999;</button></td>
                <td><button class="btn btn-link " onclick="xoa(${i})">&#10006;</button></td></tr>`
            }
            document.getElementById('displayWet').innerHTML += text;
        }
        function trinhTuA() {
            A = G = C = T = 0;
            for (let i = 0; i < mangTrinhTu.length; i++) {
                switch (mangTrinhTu[i]) {
                    case 'A':
                        A++;
                        break;
                    case 'G':
                        G++;
                        break;
                    case 'C':
                        C++;
                        break;
                    case 'T':
                        T++;
                        break;
                    case 'Y':
                        C++;
                        T++;
                        break;
                    case 'R':
                        A++;
                        G++;
                        break;
                    case 'W':
                        A++;
                        T++;
                        break;
                    case 'S':
                        G++;
                        C++;
                        break;
                    case 'K':
                        T++;
                        G++;
                        break;
                    case 'M':
                        C++;
                        A++;
                        break;
                    case 'D':
                        A++;
                        G++;
                        T++;
                        break;
                    case 'V':
                        A++;
                        C++;
                        G++;
                        break;
                    case 'H':
                        A++;
                        C++;
                        T++;
                        break;
                    case 'B':
                        C++;
                        G++;
                        T++;
                        break;
                    default:
                        break;
                }
            }
            return A, T, G, C;
        }
        function themHang(n1, n2, n3, n4, n9, n11, n12) {
            mangInp = [];
            if (n1 != '' && n2 != '' && n3 != '' && n4 != '' && n9 != '' && n11 != '' && n12 != '') {
                // mangInp.push(count);
                mangInp.push(n1, n2, n3, n4, MyoligoConc(), mangTrinhTu.length, MyMw(), MyTm(), n9, MyaddedToODV(), n11, n12, MyfromSS(), Myofbuffer());
            }
            return mangInp;
        }
        // cac cot tinh bao gồm (5), (6), (7), (8), (10), (13), (14)
        function MyoligoConc() {
            let n5 = 0;
            n5 = ((100 * parseInt(OD.value)) / (1.52 * A + 1.201 * G + 0.705 * C + 0.84 * T)) / (parseInt(volumne.value) / 1000);
            n5 = n5.toFixed(1);
            return n5;
        }
        function MyMw() {
            let n7 = 0;
            n7 = (313.21 * A + 329.21 * G + 289.18 * C + 304.2 * T) - 61.96;
            n7 = n7.toFixed(1);
            return n7;
        }
        function MyTm() {
            let n8 = 0;
            n8 = 100.5 + (41 * (G + C) / (A + T + G + C)) - (820 / (A + T + G + C)) + (16.6 * Math.log10(0.05));
            n8 = n8.toFixed(1);
            return n8;
        }
        function MyaddedToODV() {
            let n10 = 0;
            n10 = (MyoligoConc() * parseInt(volumne.value) / parseInt(concWanted.value)) - parseInt(volumne.value);
            n10 = n10.toFixed(1);
            return n10;
        }
        function MyfromSS() {
            let n13 = 0;
            n13 = parseInt(concWS.value) * parseInt(volWS.value) / parseInt(concWanted.value);
            n13 = n13.toFixed(1);
            return n13;
        }
        function Myofbuffer() {
            let n14 = 0;
            n14 = parseInt(volWS.value) - MyfromSS();
            n14 = n14.toFixed(1);
            return n14;
        }
        // tuỳ chỉnh sửa xoá
        function xoa(m) {
            mangTotal.splice(m, 1);
            hienThi();
        }
        function sua(m) {
            edit++;
            if (edit == 1) {
                document.getElementById('ketQuaWet').style.display = "none";
                document.getElementById('suaXong').style.display = "block";
                ten.value = mangTotal[m][0];
                trinhTu.value = mangTotal[m][1];
                OD.value = mangTotal[m][2];
                volumne.value = mangTotal[m][3];
                concWanted.value = mangTotal[m][8];
                concWS.value = mangTotal[m][10];
                volWS.value = mangTotal[m][11];
                mangTotal[m] = '';
            }
        }
        document.getElementById('suaXong').addEventListener('click', function () {
            if (ten.value != '' && trinhTu.value != '' && OD.value != '' && volumne.value != '' && concWanted.value != '' && concWS.value != '' && volWS.value != '') {
                document.getElementById('huongDan').innerHTML = '';
                for (let i = 0; i < mangTotal.length; i++) {
                    if (mangTotal[i] == '') {
                        mangTrinhTu = trinhTu.value.split('');
                        trinhTuA();
                        themHang(ten.value, trinhTu.value, OD.value, volumne.value, concWanted.value, concWS.value, volWS.value);
                        mangTotal[i] = mangInp;
                    }
                }
                hienThi();
                ten.value = trinhTu.value = OD.value = volumne.value = concWanted.value = concWS.value = volWS.value = '';
                document.getElementById('ketQuaWet').style.display = "block";
                document.getElementById('suaXong').style.display = "none";
                edit = 0;
                console.log(A, T, G, C);
            } else {
                document.getElementById('huongDan').innerHTML = `<p style="color: #ff0000" >Có thể 1 hoặc nhiều ô bạn đã bỏ trống </p>`
            }
        })
    </script>
</body>

</html>